{% extends "base.html" %}

{% block title %}Admin - Platform Reports{% endblock %}

{% block content %}

<div class="container mt-4">
    <h2 class="mb-4 text-success">
        <i class="bi bi-bar-chart-line-fill me-2"></i>Platform Reports
    </h2>

    <div class="row g-4">

        <div class="col-lg-6">
            <div class="card shadow-sm h-100 border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-people me-2"></i>User Statistics</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Total Users</span>
                            <strong>{{ stats.total_users|default(0) }}</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Volunteers</span>
                            <strong>{{ stats.users_by_role.volunteer|default(0) }}</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Event Leaders</span>
                            <strong>{{ stats.users_by_role.event_leader|default(0) }}</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Administrators</span>
                            <strong>{{ stats.users_by_role.admin|default(0) }}</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Active Users</span>
                            <strong>{{ stats.active_users|default(0) }}</strong>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 事件统计卡片 -->
        <div class="col-lg-6">
            <div class="card shadow-sm h-100 border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-calendar-event me-2"></i>Event Statistics</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Total Events</span>
                            <strong>{{ stats.total_events|default(0) }}</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Upcoming Events</span>
                            <strong>{{ stats.upcoming_events|default(0) }}</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Past Events</span>
                            <strong>{{ stats.past_events|default(0) }}</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Total Registrations</span>
                            <strong>{{ stats.total_registrations|default(0) }}</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Average Attendees per Event</span>
                            <strong>{{ stats.avg_attendees|default(0)|round(1) }}</strong>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 最近事件表格 -->
        <div class="col-12">
            <div class="card shadow-sm border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>Recent Events</h5>
                </div>
                <div class="card-body">
                    {% if recent_events %}
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Event Name</th>
                                    <th>Date</th>
                                    <th>Location</th>
                                    <th>Registrations</th>
                                    <th>Attendees</th>
                                    <th>Bags Collected</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for event in recent_events %}
                                <tr>
                                    <td>{{ event.event_name }}</td>
                                    <td>{{ event.event_date.strftime('%Y-%m-%d') }}</td>
                                    <td>{{ event.location }}</td>
                                    <td>{{ event.registrations }}</td>
                                    <td>{{ event.num_attendees or '-' }}</td>
                                    <td>{{ event.bags_collected or '-' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="alert alert-info text-center mb-0">
                        No events have been recorded yet.
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

    </div>

    <div class="mt-4 text-center">
        <a href="{{ url_for('admin.manage_users') }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i>Back to Manage Users
        </a>
    </div>
</div>

{% endblock %}